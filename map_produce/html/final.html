<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Digital Inequality Visualization</title>
    <meta name='viewport' content='width=device-width, initial-scale=1'/>
    <script src='https://api.mapbox.com/mapbox-gl-js/v2.2.0/mapbox-gl.js'></script>
    <link href='https://api.mapbox.com/mapbox-gl-js/v2.2.0/mapbox-gl.css' rel='stylesheet'/>
    <link href='https://api.mapbox.com/mapbox-assembly/v1.2.1/assembly.min.css' rel='stylesheet'>
    <script async defer src='https://api.mapbox.com/mapbox-assembly/v1.2.1/assembly.js'></script>
    <link href="http://fonts.cdnfonts.com/css/titillium-web" rel="stylesheet">
</head>


<style>
    body {
        margin: 0;
        padding: 0;
        /*font-family: 'Helvetica Neue', Helvetica, Arial, Sans-serif;*/
        font-family: 'Titillium Web', sans-serif;
    }

    #map {
        position: absolute;
        top: 0;
        bottom: 0;
        width: 100%;
    }

    h1 {
        font-size: 20px;
        line-height: 30px;
    }

    h2 {
        font-size: 14px;
        line-height: 20px;
        margin-bottom: 10px;
    }

    a {
        text-decoration: none;
        color: #2dc4b2;
    }

    p {
        font-size: 0.85em;
        margin: 10px;
        text-align: left;
    }

    #console {
        position: absolute;
        width: 340px;
        margin: 10px;
        padding: 10px 20px;
        background-color: white;
    }

    .session {
        margin-bottom: 20px;
    }

    .row {
        height: 12px;
        width: 100%;
    }

    .colors {
        background: linear-gradient(to right, #1A9850, #91CF60, #D9EF8B, #FEE08B, #FC8D59, #D73027);
        margin-bottom: 5px;
    }

    .label {
        width: 15%;
        display: inline-block;
        text-align: center;
    }

</style>

<body>

<div id='map'></div>
<div id='console'>
    <h1>Digital Inequality Visualization</h1>
    <br>
    <div class='session'>
        <h2>Imbalance Index</h2>
        <div class='row colors'>
        </div>
        <div class='row labels'>
            <div class='label'>0.0</div>
            <div class='label'>0.2</div>
            <div class='label'>0.4</div>
            <div class='label'>0.6</div>
            <div class='label'>0.8</div>
            <div class='label'>1.0</div>
        </div>
    </div>

    <div class="session">
        <label for="country">Country:</label>
        <select name="country" id="country">
<!--            <option value="WWW">WWW</option>-->
            <option value="USA" selected="selected">United States</option>
            <option value="AGO">Angola</option>
            <option value="FRA">French</option>
            <option value="VNM">ViteNam</option>
            <option value="BRA">Brazil</option>
            <option value="SAU">Saudi Arabia</option>
            <option value="ALB">Albania</option>
            <option value="DZA">Algeria</option>
            <option value="BHR">Bahrain</option>
            <option value="BGD">Bangladesh</option>
            <option value="BEL">Belgium</option>
            <option value="COL">Colombia</option>
            <option value="DEU">Germany</option>
            <option value="ARG">Argentina</option>
            <option value="BOL">Bolivia</option>
            <option value="CHL">Chile</option>
            <option value="PER">Peru</option>
            <option value="VEN">Venezuela</option>
            <option value="ECU">Ecuador</option>
            <option value="SUR">Suriname</option>
            <option value="GUY">Guyana</option>

        </select>
    </div>

    <div class='session'>
        <label>Type: </label>
        <div class='col' id='filters'>
            <input id='admin' type='radio' name='toggle' value='admin' checked='checked'>
            <label for='admin'>Admin</label>
            <!--            <input id='grid' type='radio' name='toggle' value='grid'>-->
            <!--            <label for='grid'>Grid</label>-->
        </div>
    </div>

    <div class='session' id='sliderbar'>
        <h2>Year: <label id='active-level'>2014</label></h2>
        <input id='slider' class='row' type='range' min='2014' max='2022' step='1' value='2014'/>
    </div>

    <p>Designed by KAUST Team</p>

</div>


</body>

<script>
    mapboxgl.accessToken = 'pk.eyJ1IjoiemN0enp5IiwiYSI6ImNrMHBrMjIyYTBrYTUzZHM4bDNlOHdvbnoifQ.aBNOdmnrTnY28EZ0AQpA3A';
    var map = new mapboxgl.Map({
        container: 'map', // container element id
        style: 'mapbox://styles/mapbox/dark-v10',
        // style: 'mapbox://styles/zctzzy/ckp1h4pn05fcu17mhsy0ok65c'
        center: [-102.80273616, 40.84706036], // initial map center in [lon, lat]
        zoom: 4,
    });

    var countries = {
        'Worldwide': {
            center: [-18.606628, 37.718556],
            zoom: 4,
        },
        'USA': {
            center: [-102.80273616, 40.84706036],
            zoom: 4
        },
        'CHN': {
            center: [107.386266, 33.125283],
            zoom: 4,
        },
        'FRA': {
            center: [1.96289018, 47.15984001],
            zoom: 6,
        },
        'AGO': {
            center: [17.459119, -12.626045],
            zoom: 5
        },
        'VNM': {
            center: [106.41357288, 17.63006299],
            zoom: 6,
        },

        'SAU': {
            center: [43.76952991, 24.70026051],
            zoom: 6,
        },
        'ALB': {
            center: [20.0811767, 40.76806171],
            zoom: 6,
        },
        'DZA': {
            center: [2.9999825, 28.0000272],
            zoom: 6,
        },
        'BHR': {
            center: [50.5344606, 26.1551249],
            zoom: 6,
        },
        'BGD': {
            center: [90.2932426, 24.4768783],
            zoom: 6,
        },
        'BEL': {
            center: [4.57946776, 50.66774274],
            zoom: 6,
        },
        'COL': {
            center: [-73.783892, 2.8894434],
            zoom: 6,
        },
        'DEU': {
            center: [10.25115965, 51.16126064],
            zoom: 6,
        },
        'ARG': {
            center: [-65.13977052, -34.89268966],
            zoom: 4,
        },
        'BOL': {
            center: [-64.9912286, -17.0568696],
            zoom: 6,
        },
        'CHL': {
            center: [-71.3187697, -31.7613365],
            zoom: 4,
        },
        'PER': {
            center: [-75.0458515, -6.8699697],
            zoom: 6,
        },
        'BRA': {
            center: [-53.2, -10.3333333],
            zoom: 4,
        },


        'VEN': {
            center: [-66.1109318, 8.0018709],
            zoom: 6,
        },

        'ECU': {
            center: [-79.3666965, -1.3397668],
            zoom: 6,
        },

        'SUR': {
            center: [-56.0771187, 4.1413025],
            zoom: 6,
        },
        'GUY': {
            center: [-58.6416891, 4.8417097],
            zoom: 6,
        },
    }

    map.on('load', function () {
        var filterCountry = ['==', ['string', ['get', 'GID_0']], 'USA'];
        var filterYear = ['==', ['number', ['get', 'year']], 2014];

        map.addSource('mb', {
            'type': 'vector',
            'url': 'mapbox://zctzzy.09vl0bpa',
        });

        map.addLayer({
            'id': 'world',
            'type': 'fill',
            'source': 'mb',
            'source-layer': 'final_index',
            paint: {
                'fill-color': [
                    'interpolate',
                    ['linear'],
                    ['number', ['get', 'index']],
                    0, '#1A9850',
                    0.2, '#91CF60',
                    0.4, '#D9EF8B',
                    0.6, '#FEE08B',
                    0.8, '#FC8D59',
                    1.0, '#D73027'
                ],
                'fill-opacity': 1.0,
                'fill-outline-color': '#000'
            },
            'filter': ['all', filterCountry, filterYear]
        })

        map.getCanvas().style.cursor = 'default';


        document.getElementById('country').addEventListener('input', function (e) {
            var country = e.target.value
            console.log(country)

            if (country == 'WWW') {
                filterCountry = ['==', ['string', ['get', 'GID_0']], 'WWW']
            } else {
                filterCountry = ['==', ['string', ['get', 'GID_0']], country]
            }

            // country == 'WWW' ? map.setFilter('world', ['==', ['string', ['get', 'GID_0']], 'WWW']) :
            //     map.setFilter('world', ['==', ['string', ['get', 'GID_0']], country])

            map.setFilter('world', ['all', filterCountry, filterYear])
            setActiveCountry(country)

        });

        var activeChapterName = 'WWW';

        function setActiveCountry(chapterName) {
            if (chapterName === activeChapterName) return;
            map.flyTo(countries[chapterName]);
            activeChapterName = chapterName;
        }

        document.getElementById('slider').addEventListener('input', function (e) {
            var year = parseInt(e.target.value);
            filterYear = ['==', ['number', ['get', 'year']], year]
            // filterYear = ['get', year.toString()+'_index']
            map.setFilter('world', ['all', filterYear, filterCountry]);

            // update text in the UI
            document.getElementById('active-level').innerText = year;
        });

    });
</script>
</html>